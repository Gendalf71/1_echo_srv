import socket  # Импортируем модуль для работы с сокетами

# Создаём сокет для TCP-соединения
sock = socket.socket()

# Привязываем сокет к адресу и порту 9090. Пустая строка означает, что сервер принимает подключения
# на всех доступных интерфейсах.
sock.bind(('', 9090))

# Начинаем прослушивание входящих подключений.
# Параметр backlog равен 0 – это означает, что сервер ожидает только одно подключение,
# что подходит для простого эхо-сервера.
sock.listen(0)

# Принимаем входящее соединение. Метод accept() блокируется до установления соединения.
conn, addr = sock.accept()

# Выводим адрес клиента, который подключился
print(addr)

# Инициализируем пустую строку для накопления полученных данных
msg = ''

# Запускаем цикл для получения данных от клиента порциями по 1024 байта (примерно 1 КБ)
while True:
    data = conn.recv(1024)  # Получаем данные (до 1024 байт за раз)
    
    # Если данные не получены (например, клиент закрыл соединение), выходим из цикла
    if not data:
        break

    # Декодируем полученные байты в строку и добавляем к переменной msg
    msg += data.decode()

    # Отправляем обратно ту же порцию данных клиенту (это и есть поведение эхо-сервера)
    conn.send(data)

# После завершения приема всех данных выводим полное сообщение, полученное от клиента
print(msg)

# Закрываем соединение с клиентом
conn.close()
